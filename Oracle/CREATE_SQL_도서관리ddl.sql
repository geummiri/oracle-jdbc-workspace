--1)출판사 테이블
DROP TABLE TB_RENT;
DROP TABLE TB_MEMBER;
DROP TABLE TB_BOOK;
DROP TABLE TB_PUBLISHER;
--외래키 참조되어 있어서 삭제 잘해야됨 ㅠㅠㅠ

CREATE TABLE TB_PUBLISHER (
    PUB_NO NUMBER,
    PUB_NAME VARCHAR2(30) NOT NULL,
    PHONE VARCHAR2(20),
    CONSTRAINT TB_PUBLISHER_PUB_NO_PK PRIMARY KEY(PUB_NO)
 );
 
 INSERT INTO TB_PUBLISHER VALUES(1, '인사이트', '02-1111-2222');
 INSERT INTO TB_PUBLISHER VALUES(2, '제이펍', '02-3333-4444');
 INSERT INTO TB_PUBLISHER VALUES(3, '한빛미디어', '02-5555-6666');
 
 SELECT * FROM TB_PUBLISHER;

 --2)도서 테이블
 CREATE TABLE TB_BOOK(
    BK_NO NUMBER,
    BK_TITLE VARCHAR2(50) NOT NULL,
    BK_AUTHOR VARCHAR2(50) NOT NULL,
    BK_PRICE NUMBER,
    CONSTRAINT TB_BOOK_BK_NO_PK PRIMARY KEY(BK_NO),
    CONSTRAINT TB_BOOK_BK_PUB_PK FOREIGN KEY(BK_PUB_NO)
      REFERENCES TB_PUBLISHER ON DELETE CASCADE 
    --FOREIGN KEY 삽입 / 부모데이터 삭제 시 자식 데이터도 삭제되도록 ON DELETE CASCADE 
 );
 
 INSERT INTO TB_BOOK VALUES(1, '프로그래머 열정을 말하다','채드 파울러', 12600, 1);
 INSERT INTO TB_BOOK VALUES(2, '1일 1로그 100일 완성 IT 지식','브라이언', 18000, 1);
 INSERT INTO TB_BOOK VALUES(3, '인스파이어드','마티 케이건', 21600, 2);
 INSERT INTO TB_BOOK VALUES(4, '혼자 공부하는 얄팍한 코딩 지식','고현민', 16200, 3);
 INSERT INTO TB_BOOK VALUES(5, '함께 자라기','김창준', 11700, 1);
 
 --3)회원 테이블
 CREATE TABLE TB_MEMBER (
    MEMBER_NO NUMBER PRIMARY KEY,
    MEMBER_ID VARCHAR2(20) NOT NULL UNIQUE,
    MEMBER_PWD VARCHAR2(20) NOT NULL,
    MEMBER_NAME VARCHAR2(20) NOT NULL,
    GENDER CHAR(2) CHECK(GENDER IN('M','F')),
    ADDRESS VARCHAR2(50),
    PHONE VARCHAR2(13),
    STATUS CHAR(2) DEFAULT 'N' CHECK(STATUS IN('Y','N')),
    ENROLL_DATE DATE DEFAULT SYSDATE NOT NULL
 );
 
 INSERT INTO TB_MEMBER VALUES 
 (1,'USER1','1234','유병재', 'M', '서울시 강남구', '010-1111-2222','N', SYSDATE);
 
 INSERT INTO TB_MEMBER VALUES 
 (2,'USER2','1234','김동현', 'M', '서울시 강남구', '010-3333-4444','N', SYSDATE);
 
 INSERT INTO TB_MEMBER VALUES 
 (3,'USER3','1234','강호동', 'F', '서울시 강남구', '010-5555-6666','N', SYSDATE);
 
--4)도서 대여 목록 테이블
 CREATE TABLE TB_RENT (
    RENT_NO NUMBER PRIMARY KEY,
    RENT_MEM_NO NUMBER REFERENCES TB_MEMBER(MEMBER_NO) ON DELETE SET NULL,
    RENT_BOOK_NO NUMBER REFERENCES TB_BOOK(BK_NO) ON DELETE SET NULL,
    RENT_DATE DATE DEFAULT SYSDATE
    --ON DELETE SET NULL :
    --부모데이터 삭제 시 해당 데이터를 쓰고 있는 자식데이터의 값을 NULL로 변경
 );
 
 INSERT INTO TB_RENT VALUES(1,1,2,SYSDATE);
 INSERT INTO TB_RENT VALUES(2,1,3,SYSDATE);
 INSERT INTO TB_RENT VALUES(3,2,1,SYSDATE);
 INSERT INTO TB_RENT VALUES(4,2,2,SYSDATE);
 INSERT INTO TB_RENT VALUES(5,1,5,SYSDATE);
 
 --TEST1
 SELECT MEMBER_NAME, MEMBER_ID, RENT_BOOK_NO, RENT_DATE, TR.RENT_DATE+7
 FROM TB_MEMBER
 JOIN TB_RENT TR ON MEMBER_NO = TR.RENT_MEM_NO
 WHERE RENT_BOOK_NO = 2;
 
 --TEST2
 SELECT BK_TITLE, PUB_NAME, RENT_DATE, TR.RENT_DATE+7
 FROM TB_BOOK B
 JOIN TB_RENT TR ON B.BK_NO = TR.RENT_BOOK_NO
 JOIN TB_MEMBER M ON M.MEMBER_NO = TR.RENT_MEM_NO
 JOIN TB_PUBLISHER PU ON PU.PUB_NO = B.BK_PUB_NO
 WHERE M.MEMBER_NO = 1;
 
 
 
 